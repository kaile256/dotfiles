# Help: https://i3wm.org/docs/userguide.html
# Ref: .xinitrc
# Else: /etc/lightdm/lightdm.conf

# Variables {{{1
# NOTE: seems no case-sensitive in variable
# Var; Font {{{2
# Note: do NOT insert size-number before commas
#   because the following fonts will be ignored;
#   thus, write different-sized fonts in another line
# Ref: https://wiki.archlinux.jp/index.php/I3
#font pango:Migu 1M 11
font pango:DejaVuSansMono Nerd Font 11
#font pango:Icons 14
# Note: some fonts such as MesloLGS, Hack causes a bug on in sequences of 'fi'
#font pango:Hack Nerd Font, DejaVu Sans Mono 11
#font pango:SF Mono Square 14

# Var; Keyname {{{2
set $Super  Mod4
set $SuperS Mod4+Shift
set $SuperC Mod4+Control
set $SuperA Mod4+Mod1
set $Alt    Mod1
set $AltC   Mod1+Control
set $AltS   Mod1+Shift

# TODO: make middle click available to bind in i3wm
set $ClickLeft   button1
set $ClickMiddle button2
set $ClickRight  button3
set $ScrollUp    button4
set $ScrollDown  button5

# Var: Command {{{2
# `--no-startup-id` disables startup-notification;
# the notification takes focus to the new window.
# Ref: [exec] in i3 User's Guide
set $release bindsym --release

set $noid   exec --no-startup-id
set $always exec_always --no-startup-id
set $restart exec_always

set $locker ~/.config/i3/lock.sh

set $menu alacritty --title fzf-menu --config-file $XDG_CONFIG_HOME/alacritty/dmenu.yml -e i3-dmenu-desktop --dmenu=fzf
# Note: j4-dmenu-desktop has a bug to regard some descriptions as an app
#set $menu alacritty --title fzf-menu --config-file $XDG_CONFIG_HOME/alacritty/dmenu.yml -e j4-dmenu-desktop --dmenu=fzf
for_window [title=^fzf-menu$] floating enable border normal

set $shortmsg exec --no-startup-id notify-send --expire-time 750
set $notify   exec --no-startup-id notify-send --expire-time 1100
set $alert    exec --no-startup-id notify-send --expire-time 1100 --urgency critical

# TODO: make $bindesc available
#set $bindesc bindsym Escape mode default; bindsym Ctrl+bracketleft mode default; bindsym bracketleft mode default; bindsym space mode default; bindsym Return mode default; bindsym Ctrl+C mode default

# Var; Apps {{{2
set $browser qutebrowser
set $chrome google-chrome-stable
set $vivaldi vivaldi-stable

set $nvim nvim-qt
set $vim vim
set $vi alacritty --title vi -e vi

set $urxvt urxvt
# urxvtc; add `-k` to kill daemon, too.
#set $urxvt urxvtc

set $termporal alacritty --title termporal --config-file $XDG_CONFIG_HOME/alacritty/botright.yml -e fish
#set $termporal alacritty --title termporal -e nvim -u $XDG_CONFIG_HOME/nvim/rc/termporal.vim
for_window [title=^termporal$] floating enable
#set $terminal urxvt

# Workspaces {{{1
# Var; i3 Workspace {{{2
workspace_layout tabbed
workspace_auto_back_and_forth no

set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"
set $ws0 "0"

# Note: workspace 0 and $ws0 would be different when $ws0 is named another
#   even if they are applied the same icon.
workspace $ws0 output eDP1
workspace $ws9 output HDMI2

# Var; i3 Window {{{2
# Use Mouse+$Super to drag floating windows to their wanted position
floating_modifier $Super
floating_maximum_size 1200 x 900
focus_follows_mouse no
# mouse_warping: output|none
mouse_warping none

## <normal|1pixel|pixel xx|none|pixel>
#default_border pixel 1
#default_floating_border normal
## Hide borders
#hide_edge_borders none

# Var; i3 Criteria {{{2
# Note: must be in double-quotes, not in single

# If Urgent, switch to the workspace immediately.
# Note: (?i) means case-Insensitive
#for_window [urgent=latest] focus

no_focus [title="qutebrowser$"]
no_focus [title="Vivaldi$"]

#assign [class="^URxvt$"] → 2
#assign [class="^URxvt$"] → output primary

for_window [title="^TMPi3"]   floating enable border normal
for_window [title="^Toggle"]  floating enable border normal
#for_window [class="calamares"] floating enable border normal
#for_window [class="Clipgrab"] floating enable
#for_window [title="File Transfer*"] floating enable
#for_window [class="Galculator"] floating enable border pixel 1
#for_window [class="GParted"] floating enable border normal
#for_window [title="i3_help"] floating enable sticky enable border normal
#for_window [class="Lightdm-settings"] floating enable
#for_window [class="Lxappearance"] floating enable border normal
#for_window [class="Manjaro Settings Manager"] floating enable border normal
#for_window [title="MuseScore: Play Panel"] floating enable
#for_window [class="Nitrogen"] floating enable sticky enable border normal
#for_window [class="Oblogout"] fullscreen enable
#for_window [class="octopi"] floating enable
#for_window [title="About Pale Moon"] floating enable
#for_window [class="Pamac-manager"] floating enable
#for_window [class="Pamac-updater"] floating enable
#for_window [class="Pavucontrol"] floating enable
#for_window [class="Qtconfig-qt4"] floating enable border normal
#for_window [class="qt5ct"] floating enable sticky enable border normal
#for_window [title="sudo"] floating enable border normal
#for_window [class="Simple-scan"] floating enable border normal
#for_window [class="(?i)System-config-printer.py"] floating enable border normal
#for_window [class="Skype"] floating enable border normal
#for_window [class="Timeset-gui"] floating enable border normal
#for_window [class="(?i)virtualbox"] floating enable border normal
#for_window [class="Xfburn"] floating enable

# AutoStart Background {{{1
# Note: see the config by `xset q`
# xset -b: disable beep
$noid xset -b
# xset -dpms(Display Power Management Signaling): off (while +dpms will turn on)
# use xss-lock insead for auto lock
$always xset -dpms
# xset -s(Screen saver)
$always xset s off

# xrandr: control monitor
$always $MYSCRIPTS/monitor-try.sh
# xautolock: a timer to lock screen of PC
# use xss instead of xautolock
# Note: xss-lock subscribes the systemd-events
$noid xss-lock -- $locker
# TODO: <c-h>/<c-w>/<c-u> are available on light-locker
#$noid light-locker --lock-on-suspend --lock-after-screensaver=600 &
#$noid xautolock -time 5 -locker $locker

# nitrogen: a wallpaper manager
# picom: an enhanced fork of compton
#   -b: activate on background
$noid nitrogen --restore; sleep 1; picom -b
## TODO: i3-cheat sheet on desktop.
#$noid "feh --bg-scale $HOME/.config/i3/~~.jpg"

# preload: already working on `systemctl enable preload.service`
#   to config, :e /etc/preload.conf
#$noid systemctl start preload.service

# necessary?
$noid sudo tlp start

# udiskie, a wrapper for udisk2
$noid udiskie --automount --notify &

# pulseaudio: deamon to control via keyboard.
$restart pulseaudio --kill; sleep 1; pulseaudio --start &

$noid alsactl daemon
# pa-applet (pulseaudio):
#$noid pa-applet
#$noid volumeicon

$noid systemctl --user start docker

# nm-applet: WiFi Network Manager; use nmcli instead
#$noid nm-applet

$noid fcitx

# dunst: Light Notification Daemon
# FAQ: https://dunst-project.org/faq/
# Conf: dunst/dunstrc
# dunst works on `notify-send`
$always killall --quiet dunst; sleep 1; dunst

# parcellite: Clipboard Manager
#$noid parcellite
$noid clipit

# Show the CP's status on the wallpaper.
#exec --no-startup-id start_conky_live_maia
#exec --no-startup-id blueman # use bluetoothctl
#exec --no-startup-id pamac-tray
#exec --no-startup-id desktop-items
#exec --no-startup-id /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1
# exec_always --no-startup-id sbxkb
#exec --no-startup-id xfce4-power-manager
#exec_always --no-startup-id ff-theme-util
#exec_always --no-startup-id setcursor
#bindsym $mod+Ctrl+M exec pavucontrol

# urxvtd: Daemon of rxvt-unicode. Use urxvtc as a client.
#$noid "urxvtd -o -f"

# Note: exec_always to reload on a restart i3 itself
$always $MYSCRIPTS/polybar-launch.sh
#exec_always --no-startup-id xfce4-panel --disable-wm-check

# AutoStart Applications {{{1
# Ref: specifiy workspace to start in
#    @ https://ayageman.blogspot.com/2017/02/t510-2.html
# TODO: open qutebrowser in background

#$noid qutebrowser
#$noid $vivaldi
#$noid nvim-qt

## Status Bar; use polybar instead {{{1
## Note: use polybar instead
## Start i3bar to display a workspace bar (plus the system information i3status
## finds out, if available)
#bar {
## Use pyi3status instead (status_command python ~/.config/i3/i3status/config.py)
#i3bar_command ${XDG_CONFIG_HOME}/polybar/launch.sh
#status_command i3status
##status_command i3blocks -c ~/.config/i3/i3bar/i3blocks/config
#output            eDP1
#output            HDMI1
#output            HDMI2
#output            LVDS1
#position          bottom
#mode              dock
#workspace_buttons yes
#tray_output       both
#font pango:Icons, SF Mono 12
#colors {
#background #000000
#statusline #ffffff
#focused_workspace  #ffffff #285577
#active_workspace   #ffffff #333333
#inactive_workspace #888888 #222222
#urgent_workspace   #ffffff #900000
#}
#}

# Keybind; i3's Reload/Restart {{{1
# reload the configuration file
$release $SuperS+space reload
# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
$release $Super+space restart

# Keybind; i3 Workspace {{{1
bindsym $SuperS+T layout tabbed; $alert 'Layout: tabbed'
# Note: check keyname, or keycode, by $ xmodmap -pke
# Note: `--release` disturbs continuous actions while pressed

# Note: `;` chains commands; `,` only applys former command to applied window
# Sample: bindsym $mod+X move container to workspace 3; workspace 3
# Sample: for_window [class="^foo$"] floating enable, move container to workspace 4

# Workspace; Focus Switch {{{2
workspace_auto_back_and_forth yes
# [smart|urgent|focus|none]
focus_on_window_activation smart
#bindsym $SuperS+6 workspace back_and_forth
#bindsym $SuperC+6 move container to workspace back_and_forth; workspace back_and_forth

bindsym $Super+bracketleft  workspace prev
bindsym $Super+bracketright workspace next

bindsym $Super+1 workspace $ws1
bindsym $Super+2 workspace $ws2
bindsym $Super+3 workspace $ws3
bindsym $Super+4 workspace $ws4
bindsym $Super+5 workspace $ws5
bindsym $Super+6 workspace $ws6
bindsym $Super+7 workspace $ws7
bindsym $Super+8 workspace $ws8
bindsym $Super+9 workspace $ws9
bindsym $Super+0 workspace $ws0

# Workspace; Move {{{3
bindsym $SuperS+1 move container to workspace $ws1; workspace $ws1
bindsym $SuperS+2 move container to workspace $ws2; workspace $ws2
bindsym $SuperS+3 move container to workspace $ws3; workspace $ws3
bindsym $SuperS+4 move container to workspace $ws4; workspace $ws4
bindsym $SuperS+5 move container to workspace $ws5; workspace $ws5
bindsym $SuperS+6 move container to workspace $ws6; workspace $ws6
bindsym $SuperS+7 move container to workspace $ws7; workspace $ws7
bindsym $SuperS+8 move container to workspace $ws8; workspace $ws8
bindsym $SuperS+9 move container to workspace $ws9; workspace $ws9
bindsym $SuperS+0 move container to workspace $ws0; workspace $ws0

# Workspace; Move in background {{{2
bindsym $SuperC+1 move container to workspace $ws1
bindsym $SuperC+2 move container to workspace $ws2
bindsym $SuperC+3 move container to workspace $ws3
bindsym $SuperC+4 move container to workspace $ws4
bindsym $SuperC+5 move container to workspace $ws5
bindsym $SuperC+6 move container to workspace $ws6
bindsym $SuperC+7 move container to workspace $ws7
bindsym $SuperC+8 move container to workspace $ws8
bindsym $SuperC+9 move container to workspace $ws9
bindsym $SuperC+0 move container to workspace $ws0

bindsym $SuperA+1 move container to workspace $ws1
bindsym $SuperA+2 move container to workspace $ws2
bindsym $SuperA+3 move container to workspace $ws3
bindsym $SuperA+4 move container to workspace $ws4
bindsym $SuperA+5 move container to workspace $ws5
bindsym $SuperA+6 move container to workspace $ws6
bindsym $SuperA+7 move container to workspace $ws7
bindsym $SuperA+8 move container to workspace $ws8
bindsym $SuperA+9 move container to workspace $ws9
bindsym $SuperA+0 move container to workspace $ws0

# Keybind; Window {{{2
bindsym $Super+H focus left
bindsym $Super+J focus down
bindsym $Super+K focus up
bindsym $Super+L focus right

# Note: $SuperC+H fails without error-msg
bindsym $SuperS+H move left
bindsym $SuperS+J move down
bindsym $SuperS+K move up
bindsym $SuperS+L move right

bindsym Shift+F11 fullscreen toggle ; $alert 'Layout: fullscreen toggle'

# Mnemonic: `o` on visual-mode to the other end of the area
bindsym $Super+O focus mode_toggle; $alert 'Focus: Toggle'

# Mnemonic: go Over the window
bindsym $SuperS+O focus floating; mode default; $alert 'Focus: Floating'
# Mnemonic: Insert from another window over the window
bindsym $SuperS+I focus tiling;   mode default; $alert 'Focus: Tiling'

# Keybind; Device Toggle {{{2
# Ref: https://qiita.com/iberianpig/items/08784c9b2f53b3e41409
#   Control Trackpad by Fusuma
$release $Super+comma  $noid $MYSCRIPTS/touchpad-toggle.sh
$release $Super+period $noid $MYSCRIPTS/touchpad-toggle.sh
$release $Super+$ClickMiddle $noid $MYSCRIPTS/touchpad-toggle.sh

# 66: CapsLock
bindcode 66 $alert 'CapsLock: Toggle'

# Keybind; xdotool {{{1
# bind <tab> via xdotool seems no use in Qutebrowser
#bindsym Ctrl+i $noid xdotool Tab

# Keybind; Mode on i3 {{{1
# WARNING: use double quotes for either in `set` or `mode`
# Mode; Layout {{{2
set $Layout " Layout: (T)abbed fl(O)ating | Resize: HJKL | (W) for Window mode"
$release $SuperS+W mode $Layout; $alert 'Layout mode'

mode $Layout {
$release W       mode $Window; $notify 'Window mode'
$release Shift+W mode $Window; $notify 'Window mode'

#bindsym H split h; mode default; $alert 'Layout: horizontal'
#bindsym V split v; mode default; $alert 'Layout: vertical'

bindsym T layout tabbed;   mode default; $alert 'Layout: tabbed'
#bindsym K layout stacking; mode default; $alert 'Layout: stacking'

# Note: Fullscreen/Floating could be irritative;
#       window sometimes hides on the status-bar
bindsym O floating   toggle; mode default; $alert 'Layout: floating toggle'
#bindsym U fullscreen toggle; mode default; $alert 'Layout: fullscreen toggle'
bindsym $Super+O focus mode_toggle; mode default; $alert 'Focus: Toggle'

bindsym H resize shrink width  1 px or 1 ppt
bindsym K resize shrink height 1 px or 1 ppt
bindsym J resize grow   height 1 px or 1 ppt
bindsym L resize grow   width  1 px or 1 ppt

bindsym F resize grow   width  10 px or 10 ppt
bindsym B resize shrink width  10 px or 10 ppt
bindsym D resize grow   height 10 px or 10 ppt
bindsym U resize shrink height 10 px or 10 ppt

bindsym Shift+H resize shrink width  25 px or 25 ppt
bindsym Shift+K resize shrink height 25 px or 25 ppt
bindsym Shift+J resize grow   height 25 px or 25 ppt
bindsym Shift+L resize grow   width  25 px or 25 ppt

bindsym Shift+F resize grow   width  50 px or 50 ppt
bindsym Shift+B resize shrink width  50 px or 50 ppt
bindsym Shift+D resize grow   height 50 px or 50 ppt
bindsym Shift+U resize shrink height 50 px or 50 ppt

bindsym Ctrl+C           mode default
bindsym bracketleft      mode default
bindsym Ctrl+bracketleft mode default
}

# Mode; Window {{{2
set $Window " Window: (C)lose or (Q)uit to kill current window | fl(O)ating toggle | (W) for Layout mode "
$release $Super+W mode $Window; $shortmsg 'Window mode'

mode $Window {
$release W       mode $Layout; $alert 'Layout mode'
$release Shift+W mode $Layout; $alert 'Layout mode'

bindsym T layout tabbed;   mode default; $alert 'Layout: tabbed'

$release C kill; mode default
$release Q kill; mode default

bindsym minus $noid picom -cbm 0.75
bindsym plus  $noid picom -cbm 0.75

#bindsym Shift+H move left
#bindsym Shift+L resize grow   width  25 px or 25 ppt

bindsym Shift+B move left  100 px
bindsym Shift+F move right 100 px
bindsym Shift+D move down  100 px
bindsym Shift+U move up    100 px

# especially for floating window
bindsym H move left  1 px
bindsym J move down  1 px
bindsym K move up    1 px
bindsym L move right 1 px

# especially for floating window
bindsym Shift+H move left  25 px
bindsym Shift+J move down  25 px
bindsym Shift+K move up    25 px
bindsym Shift+L move right 25 px

bindsym B move left  50 px
bindsym F move right 50 px
bindsym D move down  50 px
bindsym U move up    50 px

## Mnemonic: parent is older, <c-o>; child is newer, <c-i> in vim
bindsym Ctrl+O focus parent; mode default
bindsym Ctrl+I focus child;  mode default

# mode_toggle: toggle between floating and tiling
bindsym $Super+O focus mode_toggle; mode default; $alert 'Focus: Toggle'
bindsym O        focus mode_toggle; mode default; $alert 'Focus: Toggle'

# TODO: send ^d, too, to kill terminal
bindsym Ctrl+D           mode default; $alert 'Out of Fucus mode'

bindsym Ctrl+C           mode default
bindsym bracketleft      mode default
bindsym Ctrl+bracketleft mode default
}

# Mode; Systemctl {{{2
set $Systemctl " Systemctl: [P]oweroff [R]eboot [L]ock [S]uspend(to RAM) [H]ybernate(to Disk) (B)oth(to RAM & Disk) "
$release $Super+X mode $Systemctl; $alert 'Systemctl mode'

mode $Systemctl {
#bindsym S $noid $locker && systemctl suspend, mode default
#bindsym L $noid i3-msg exit, mode default
#bindsym K $noid i3-msg exit, mode default
$release l $noid $locker, mode default
$release k $noid $locker, mode default

$release s $noid systemctl suspend && $locker,      mode default
# TODO: make swap
$release h $noid $locker && systemctl hibernate,    mode default
# hybrid-sleep: the battery depleted left disk
$release b $noid $locker && systemctl hibrid-sleep, mode default

$release r $noid systemctl reboot,   mode default
$release p $noid systemctl poweroff, mode default
$release q $noid systemctl poweroff, mode default
$release y $noid systemctl poweroff, mode default
$release u $noid systemctl poweroff, mode default

bindsym Ctrl+C           mode default
bindsym bracketleft      mode default
bindsym Ctrl+bracketleft mode default
}

# Mode; Backlight {{{2
set $Backlight " Backlight: H:100, M:50, L:5 "
$release $Super+Ctrl+B mode $Backlight; $shortmsg 'Backlight mode'

mode $Backlight {
bindsym Shift+H $alert 'Brightness: 100'; $noid xbacklight -set 100
bindsym H       $alert 'Brightness: 100'; $noid xbacklight -set 100
bindsym Shift+M $alert 'Brightness: 50';  $noid xbacklight -set 50
bindsym M       $alert 'Brightness: 50';  $noid xbacklight -set 50
bindsym Shift+L $alert 'Brightness: 5'; $noid sleep 1; $noid xbacklight -set 5
bindsym L       $alert 'Brightness: 5'; $noid sleep 1; $noid xbacklight -set 5

bindsym K $notify 'Brightness: +1';  $noid xbacklight -inc 1
bindsym J $notify 'Brightness: -1';  $noid xbacklight -dec 1
bindsym U $notify 'Brightness: +5';  $noid xbacklight -inc 5
bindsym D $notify 'Brightness: -5';  $noid xbacklight -dec 5
bindsym B $notify 'Brightness: +10'; $noid xbacklight -inc 10
bindsym F $notify 'Brightness: -10'; $noid xbacklight -dec 10

bindsym Ctrl+C           mode default
bindsym bracketleft      mode default
bindsym Ctrl+bracketleft mode default
}

# Mode; Sound Volume {{{2
# Ref: Relation of Alsa & PluseAudio
# [https://qiita.com/propella/items/4699eda71cd742cba8d3]
# `pacmd list-sinks` to get list to control
## Depends: pulseaudio & pavucontrol
# Depends: pulseaudio-ctl
# Recommend: pacmixer (a frontend of ALSA for pulseaudio)
# Recommend: pulseaudio-alsa (for flash)
set $Sound " Sound Volume: (Q)uiet or (S)ilence to mute "
$release $Super+S mode $Sound; $shortmsg 'Sound mode'
# Ref: https://stackoverflow.com/questions/21688115/pactl-called-from-systemd-service-always-reports-pa-context-connect-failed-co
# when you have `Connection failure: Connection refused; pa_context_connect() failed: Connection refused`

set $mute exec --no-startup-id pacmd set-sink-mute @DEFAULT_SINK@ true; mode default
set $unmute      exec --no-startup-id pacmd set-sink-mute @DEFAULT_SINK@ false
set $mute_toggle exec --no-startup-id pacmd set-sink-mute @DEFAULT_SINK@ toggle
# Note: failed to use $unmute in $volume; cannot nest variable?
set $volume exec --no-startup-id pacmd set-sink-mute @DEFAULT_SINK@ false && pactl set-sink-volume @DEFAULT_SINK@

mode $Sound {
#bindsym M $mute_toggle; $alert 'Sound: mute/unmute'
# Mnemonic: Silence
bindsym S $mute; $alert 'Sound: Mute'
# Mnemonic: Quiet
bindsym Q $mute; $alert 'Sound: Mute'

# Note: it is weird thatset to 50% will set to 72%
bindsym H $volume 100%; $notify 'Sound: 100'
bindsym M $volume 30%;  $notify 'Sound: 50'
bindsym L $volume 0%;   $notify 'Sound: 0'
bindsym Shift+H $volume 100%; $notify 'Sound: 100'
bindsym Shift+M $volume 30%;  $notify 'Sound: 50'
bindsym Shift+L $volume 0%;   $notify 'Sound: 0'

bindsym K $volume +1%;  $notify 'Sound: +1%'
bindsym J $volume -1%;  $notify 'Sound: -1%'
bindsym U $volume +5%;  $notify 'Sound: +5%'
bindsym D $volume -5%;  $notify 'Sound: -5%'
bindsym B $volume +10%; $notify 'Sound: +10%'
bindsym F $volume -10%; $notify 'Sound: -10%'

bindsym Ctrl+C           mode default
bindsym bracketleft      mode default
bindsym Ctrl+bracketleft mode default
}

# Keybind; Mode for apps {{{1
# Mode; Terminal Location {{{2
# TODO: keep transparency after restart i3
#bindsym $Super+T exec $termporal
bindsym $Super+Return exec $termporal

#set $Terminal " Console: (A)lacritty (U)rxvt (X)term "
#bindsym $Super+C mode $Console; $shortmsg 'Consoles'
set $Terminal " Terminal: (H)topleft (J)botleft (K)topright (L)botright"
bindsym $Super+semicolon mode $Terminal; $shortmsg 'Terminals'

mode $Terminal {
# TODO: apply geometry by i3-msg
bindsym H exec $urxvt -e fish; mode default
bindsym J exec $urxvt -e fish; mode default
bindsym K exec $urxvt -e fish; mode default
bindsym L exec $urxvt -e fish; mode default

bindsym Ctrl+C           mode default
bindsym bracketleft      mode default
bindsym Ctrl+bracketleft mode default
}

# Mode; Console {{{2
bindsym $Super+U exec $urxvt -e fish
set $Console " Console: (A)lacritty (U)rxvt (X)term | (G)otop "
bindsym $Super+C mode $Console; $shortmsg 'Consoles'

mode $Console {
bindsym A exec alacritty -e fish;  mode default
bindsym U exec $urxvt    -e fish;  mode default
bindsym X exec xterm     -e fish;  mode default
bindsym G exec alacritty -e gotop; mode default

bindsym T        exec $termporal; mode default
bindsym $Super+T exec $termporal; mode default
bindsym C        exec $termporal; mode default
bindsym $Super+C exec $termporal; mode default

bindsym Ctrl+C           mode default
bindsym bracketleft      mode default
bindsym Ctrl+bracketleft mode default
}

# Mode; Browser {{{2
bindsym $Super+grave      $noid alacritty --title termporal --config-file $XDG_CONFIG_HOME/alacritty/center.yml -e fzf-qutebrowser-bookmarks qutebrowser
bindsym $Super+apostrophe $noid alacritty --title termporal --config-file $XDG_CONFIG_HOME/alacritty/center.yml -e fzf-qutebrowser-bookmarks qutebrowser
set $Browser " Browser: (S)ervo (V)ivaldi (F)irefox (C)hrome (Q)utebrowser "

$release $Super+B mode $Browser; $shortmsg 'Browsers'

mode $Browser {
$release q $noid qutebrowser; mode default; $noid xinput enable Elan\ Touchpad; $noid xinput enable Elan\ TrackPoint
$release c $noid $chrome;     mode default; $noid xinput enable Elan\ Touchpad; $noid xinput enable Elan\ TrackPoint
$release f $noid firefox;     mode default; $noid xinput enable Elan\ Touchpad; $noid xinput enable Elan\ TrackPoint
$release s $noid servo;       mode default; $noid xinput enable Elan\ Touchpad; $noid xinput enable Elan\ TrackPoint
$release v $noid $vivaldi;    mode default; $noid xinput enable Elan\ Touchpad; $noid xinput enable Elan\ TrackPoint

bindsym Ctrl+C           mode default
bindsym bracketleft      mode default
bindsym Ctrl+bracketleft mode default
}

# Keybind; open Browser {{{2
set $Qutebrowser " Qutebrowser: Type a Number for workspace to launch "

#$release $Super+Q $noid qutebrowser; $notify 'Qutebrowser: Stand by...'
$release $Super+Q mode $Qutebrowser; $shortmsg 'Qutebrowser'

mode $Qutebrowser {
# FIXME: make the mode work. If possible, start in background.
# Note: cannot include --no-startup-id
$release 0 $noid i3-msg 'workspace 0; exec qutebrowser'; mode default
$release 1 $noid i3-msg 'workspace 1; exec qutebrowser'; mode default
$release 2 $noid i3-msg 'workspace 2; exec qutebrowser'; mode default
$release 3 $noid i3-msg 'workspace 3; exec qutebrowser'; mode default
$release 4 $noid i3-msg 'workspace 4; exec qutebrowser'; mode default
$release 5 $noid i3-msg 'workspace 5; exec qutebrowser'; mode default
$release 6 $noid i3-msg 'workspace 6; exec qutebrowser'; mode default
$release 7 $noid i3-msg 'workspace 7; exec qutebrowser'; mode default
$release 8 $noid i3-msg 'workspace 8; exec qutebrowser'; mode default
$release 9 $noid i3-msg 'workspace 9; exec qutebrowser'; mode default

bindsym Ctrl+C           mode default
bindsym bracketleft      mode default
bindsym Ctrl+bracketleft mode default
}

# Mode; Vim {{{2
set $Vim " Vim: (X)term (U)rxvt (A)lacritty "
$release $Super+V mode $Vim; $shortmsg 'Vim: backends'

mode $Vim {
# Vim
# Note: <a-h> and so kind does NOT seem to work on vim
# TODO: nvim-qt with 'nvim -c'-like startup in i3 instead, not in vimscript
bindsym U $noid urxvt -e vim; mode default
# Note: some shortcut like '<c-u>' to delete does NOT work on vim's terminal (vim-fzf at least) on xterm
bindsym X $noid xterm -e vim; mode default
bindsym A $noid alacritty -e vim; mode default

bindsym Ctrl+C           mode default
bindsym bracketleft      mode default
bindsym Ctrl+bracketleft mode default
}

# Mode; Neovim {{{2
set $Neovim " Neovim: (Q)t (G)o (R)ust (T)ypescript (A)lacritty "
$release $Super+N mode $Neovim; $shortmsg 'Neovim: backends'

mode $Neovim {
# Vim
# TODO: nvim-qt with 'nvim -c'-like startup in i3 instead, not in vimscript
bindsym Q $noid nvim-qt; mode default
bindsym G $noid gonvim;  mode default
bindsym R $noid gnvim;   mode default
bindsym T $noid nyaovim; mode default
#bindsym A $noid glrnvim; mode default
bindsym A $noid alacritty -e nvim; mode default

bindsym Ctrl+C           mode default
bindsym bracketleft      mode default
bindsym Ctrl+bracketleft mode default
}

# Mode; Editor {{{2
set $Editor " Editor: (C)ode (E)macs (V)im (N)eovim | (G)imp (P)inta "

$release $Super+E mode $Editor; $shortmsg 'Editors'

mode $Editor {
bindsym C $noid code;  mode default; $notify 'Editor: vscode'
bindsym E $noid emacs; mode default; $notify 'Editor: emacs'
bindsym V $noid $vim;  mode default; $notify 'Editor: vim'
bindsym N $noid $nvim; mode default; $notify 'Editor: neovim'

bindsym G $noid gimp;  mode default; $notify 'Editor: gimp'
bindsym P $noid pinta; mode default; $notify 'Editor: pinta'

bindsym Ctrl+C           mode default
bindsym bracketleft      mode default
bindsym Ctrl+bracketleft mode default
}

# Mode; Dotfiles {{{2
set $Dotfiles " Dotfiles: (V)im (I)3/(P)olybar (S)hell (T)erminals "

$release $Super+D mode $Dotfiles; $shortmsg 'Dotfiles'

set $fzf_dotfiles alacritty --title fzf_vim -e fzf-dotfiles

mode $Dotfiles {
bindsym V mode default; $notify 'Dotfiles: vimrc';      exec $fzf_dotfiles --vimrc
bindsym I mode default; $notify 'Dotfiles: i3/polybar'; exec $fzf_dotfiles --i3
bindsym P mode default; $notify 'Dotfiles: i3/polybar'; exec $fzf_dotfiles --i3
bindsym S mode default; $notify 'Dotfiles: shell';      exec $fzf_dotfiles --shell
bindsym T mode default; $notify 'Dotfiles: terminal';   exec $fzf_dotfiles --terminal

bindsym Ctrl+C           mode default
bindsym bracketleft      mode default
bindsym Ctrl+bracketleft mode default
}

# Mode; Finder {{{2
# Mnemonic: Finder or File explorer
set $Finder " Finder: [N]nn [R]anger [H]unter [P]CManFM(lxde) PCManFM-[Q]t(lxqt) [T]hunar(Xfce) (G)ooglePhoto "
$release $Super+F  mode $Finder; $shortmsg 'Finders'

mode $Finder {
$release P exec pcmanfm; mode default
$release Q exec pcmanfm-qt; mode default
$release T exec thunar; mode default

$release N exec terminal -e nnn; mode default
$release R exec alacritty -e ranger; mode default
$release H exec alacritty -e hunter; mode default

$release G exec google-photo; mode default

bindsym Ctrl+C           mode default
bindsym bracketleft      mode default
bindsym Ctrl+bracketleft mode default
}

# Mode; Mozc {{{2
set $Mozc " Mozc: Activated "
bindsym $Super+M $noid fcitx-remote -s mozc; mode $Mozc; $notify 'Mozc: Activated'

# TODO: deprecate mode for IME, but use script in while-loop
mode $Mozc {
# TODO: send-key Ctrl+U and back to the fcitx-state
bindsym Ctrl+U $noid fcitx-remote -c; mode default; $notify 'Mozc: OFF'
bindsym Ctrl+W $noid fcitx-remote -c; mode default; $notify 'Mozc: OFF'
bindsym L      $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'

bindsym $Super+I $noid fcitx-remote -s skk; mode $Skk; $alert 'Skk: Activated'

bindsym $Super+1 $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; workspace $ws1
bindsym $Super+2 $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; workspace $ws2
bindsym $Super+3 $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; workspace $ws3
bindsym $Super+4 $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; workspace $ws4
bindsym $Super+5 $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; workspace $ws5
bindsym $Super+6 $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; workspace $ws6
bindsym $Super+7 $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; workspace $ws7
bindsym $Super+8 $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; workspace $ws8
bindsym $Super+9 $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; workspace $ws9
bindsym $Super+0 $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; workspace $ws0
bindsym $Super+H $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; focus left
bindsym $Super+J $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; focus down
bindsym $Super+K $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; focus up
bindsym $Super+L $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; focus right
bindsym $Super+O $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; focus mode_toggle; $alert 'Focus: Toggle'
bindsym $Super+bracketleft  $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; workspace prev
bindsym $Super+bracketright $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'; workspace next

bindsym $Super+M         $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'
bindsym Ctrl+C           $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'
bindsym bracketleft      $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'
bindsym Ctrl+bracketleft $noid fcitx-remote -c; mode default; $alert 'Mozc: OFF'
}

# Mode; Skk {{{2
set $Skk " Skk: (q) kata/hira (l) ASCII "
bindsym $Super+I $noid fcitx-remote -s skk; mode $Skk; $notify 'Skk: Activated'

mode $Skk {
# TODO: send-key Ctrl+U and back to the fcitx-state
bindsym Ctrl+U  $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'
bindsym Ctrl+W  $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'
bindsym Shift+L $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'

bindsym $Super+M $noid fcitx-remote -s mozc; mode $Mozc; $alert 'Mozc: Activated'

bindsym $Super+1 $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; workspace $ws1
bindsym $Super+2 $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; workspace $ws2
bindsym $Super+3 $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; workspace $ws3
bindsym $Super+4 $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; workspace $ws4
bindsym $Super+5 $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; workspace $ws5
bindsym $Super+6 $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; workspace $ws6
bindsym $Super+7 $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; workspace $ws7
bindsym $Super+8 $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; workspace $ws8
bindsym $Super+9 $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; workspace $ws9
bindsym $Super+0 $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; workspace $ws0

bindsym $Super+H $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; focus left
bindsym $Super+J $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; focus down
bindsym $Super+K $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; focus up
bindsym $Super+L $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; focus right
bindsym $Super+O $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; focus mode_toggle; $alert 'Focus: Toggle'
bindsym $Super+bracketleft  $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; workspace prev
bindsym $Super+bracketright $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'; workspace next

# TODO: return to skk's japanese input by <c-space>
bindsym L        $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'
bindsym Shift+L  $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'
bindsym $Super+I $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'

bindsym Ctrl+C           $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'
bindsym bracketleft      $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'
bindsym Ctrl+bracketleft $noid fcitx-remote -c; mode default; $alert 'Skk: OFF'
}

# Keybind for Apps {{{1
# Keybind; open Menu {{{2
# # TODO: convert this bash-script into fish's
# Ref: dmenu with fzf https://github.com/junegunn/fzf/wiki/Examples
bindsym $Super+backslash $noid $menu

# Keybind; open Editor {{{2
# the numbar is RAM by htop in terminal of the editor
# nvim on alacritty: 448M
#bindsym $Super+N $noid nvim-qt
##bindsym $Super+Q $noid nvim-qt
#bindsym $Super+V $noid alacritty -e 'vim'
#bindsym $Super+A $noid alacritty -e 'nvim'
## nvim-qt: 418M
## TODO: start nvim-qt sharing the buffer-list w/ another nvim-qt which is already started.
##bindsym $SuperS+N $noid i3-sensible-terminal -e "nvim-qt --server $NVIM_LISTEN_ADDRESS"
##bindsym $Super+R $noid nvim-gtk # font decayed
#bindsym $SuperS+G $noid glrnvim
##bindsym $SuperS+G $noid gonvim
## gnvim: 612M, but firstest startup in 3 sec
#bindsym $Super+G $noid gnvim
##bindsym $Super+Y $noid nyaovim
## oni: 718M
#bindsym $Super+O $noid oni
#bindsym $Super+E $noid emacs
## code: 847M
#bindsym $SuperS+V $noid code
#bindsym $SuperS+C $noid code

# Keybind; Sound Volume {{{2
#bindsym $Super+Ctrl+M exec terminal -e 'alsamixer'

# Keybind; Music Player {{{2
$release $SuperS+M exec terminal -e 'mocp'

# Keybind on Fn {{{1
# Fn; Backlight {{{2
bindsym XF86MonBrightnessUp   $noid xbacklight -inc 5; $notify 'Brightness: +5'
bindsym XF86MonBrightnessDown $noid xbacklight -dec 5; $notify 'Brightness: +5'

# Fn; Audio Volume {{{2
# Depends: pulseaudio & pavucontrol
# Recommend: pamixer (a frontend)
# Recommend: pulseaudio-alsa (for flash)
bindsym XF86AudioRaiseVolume $noid pactl set-sink-volume 0 +5%
bindsym XF86AudioLowerVolume $noid pactl set-sink-volume 0 -5%
bindsym XF86AudioMute        $noid pactl set-sink-mute 0 toggle

# Fn; Screen Shot {{{2
# depend: imagemagick
#bindsym $Super+Print $noid import -window root ~/Pictures/screenshot
bindsym Shift+Print  $noid shutter --select
bindsym $Super+Print $noid $MYSCRIPTS/recording-toggle.sh

#set $Print " Print: (Shift+) screenshot | (Super+) record in GIF "
#bindsym Print mode $Print; $notify 'Print: entered'
#mode $Print {
#bindsym Print        mode default; $noid exec $MYSCRIPTS/recording-toggle.sh
#bindsym Shift+Print  mode default; $noid i3-scrot
#bindsym $Super+Print mode default; $noid exec $MYSCRIPTS/recording-toggle.sh
#
#bindsym Ctrl+C           mode default
#bindsym bracketleft      mode default
#bindsym Ctrl+bracketleft mode default
#}

# Keybind of Default {{{1
#bindsym $Super+Shift+minus move scratchpad
#bindsym $Super+Shift+F3 exec gksu pcmanfm
#bindsym $SuperS+I exec calamares_polkit

## Config for i3-gaps: {{{1
#
## Set inner/outer gaps
#gaps inner 14
#gaps outer -2
#
## Additionally, you can issue commands with the following syntax. This is useful to bind keys to changing the gap size.
## gaps inner|outer current|all set|plus|minus <px>
## gaps inner all set 10
## gaps outer all plus 5
#
## Smart gaps (gaps used if only more than one container on the workspace)
#smart_gaps on
#
## Smart borders (draw borders around container only if it is not the only container on this workspace)
## on|no_gaps (on=always activate and no_gaps=only activate if the gap size to the edge of the screen is 0)
#smart_borders on
#
## Press $mod+Shift+G to enter the gap mode. Choose o or i for modifying outer/inner gaps. Press one of + / - (in-/decrement for current workspace) or 0 (remove gaps for current workspace). If you also press Shift with these keys, the change will be global for all workspaces.
#set $mode_gaps Gaps: (o) outer, (i) inner
#set $mode_gaps_outer Outer Gaps: +|-|0 (local), Shift + +|-|0 (global)
#set $mode_gaps_inner Inner Gaps: +|-|0 (local), Shift + +|-|0 (global)
#bindsym $mod+Shift+G mode "$mode_gaps"
#
#mode "$mode_gaps" {
#        bindsym O      mode "$mode_gaps_outer"
#        bindsym I      mode "$mode_gaps_inner"
#}
#mode "$mode_gaps_inner" {
#        bindsym plus  gaps inner current plus 5
#        bindsym minus gaps inner current minus 5
#        bindsym 0     gaps inner current set 0
#
#        bindsym Shift+plus  gaps inner all plus 5
#        bindsym Shift+minus gaps inner all minus 5
#        bindsym Shift+0     gaps inner all set 0
#
#}
#mode "$mode_gaps_outer" {
#        bindsym plus  gaps outer current plus 5
#        bindsym minus gaps outer current minus 5
#        bindsym 0     gaps outer current set 0
#
#        bindsym Shift+plus  gaps outer all plus 5
#        bindsym Shift+minus gaps outer all minus 5
#        bindsym Shift+0     gaps outer all set 0
#}


