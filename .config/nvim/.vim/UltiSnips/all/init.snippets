global !p
def bash_in_strict_mode():
  bash_options = 'set -Ceuo pipefail'
  internal_field_separators = "IFS=$'\\n\\t'"

  options = (
    bash_options,
    internal_field_separators,
    )

  return '\n'.join(options)
endglobal

snippet '\s*#!' "shebang" "snip.line == 0" bre
#!/usr/bin/env ${1:python}
`!p
if t[1] == 'bash':
  snip.rv = '\n' + bash_in_strict_mode() + '\n'
`
${2:content}
endsnippet


priority -20

snippet '\s*([a-z]{2,})' "#! for the program" "snip.line == 0" bre
#!/usr/bin/env `!p snip.rv = match.group(1)`${1}
`!p
if match.group(1) == 'bash':
  snip.rv = '\n' + bash_in_strict_mode() + '\n'
`
${2:content}
endsnippet
